<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">

	<!-- ensure proper rendering and touch zooming -->
    <meta name="viewport" content="width=device-width, initial-scale=1">


	<script src="/socket.io/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
	<script src="/qrcode.js"></script>


	<!-- Bootstrap files: -->
		<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<!-- Popper JS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>


	<style>
  .fakeimg {
    height: 200px;
    background: #aaa;
  }
  </style>


	<title>Welcome</title>
		

</head>


<body>		

	


<div class="jumbotron text-center" style="margin-bottom:0">
  <h1>Welcome to the Store</h1>
  <p>please scan the QRcode with your smartphone</p> 
</div>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark">

  <div class="collapse navbar-collapse" id="collapsibleNavbar">
    <ul class="navbar-nav">
      <li class="nav-item">
      </li>
      <li class="nav-item">
      </li>
      <li class="nav-item">
      </li>    
    </ul>
  </div>  
</nav>

<div class="container" style="margin-top:30px">
   

    <div id="here" style="margin-bottom: 60px">   

      <br>
    </div>
</div>

<div class="jumbotron text-center" style="margin-bottom:0">
  <p>template by w3schools.com</p>
  <p>Friday, 15 March 2019</p>
</div>





	<script>	
	$(function () {
	
		//
		var socket = io();
		

		// send an initial signal to get the IP settings for the first code
		socket.emit('request initial data');
		socket.on('initial data', function(data){

			var $nd = $( "<div id='qrcode' ></div>" );
			$( "#here" ).append( $nd );

			qrcode = new QRCode(document.getElementById("qrcode"), data+'');    // QRCode does not work with a pure number as a 2nd argument

			document.getElementById("qrcode").style.margin="0 auto";
			document.getElementById("qrcode").style.width="256px";

			console.log("making initial code with '" + data + "'");
		});
		// should use something like JSON instead ??
		

		//
		socket.on('reset code', function(link){
						
			//wait a few seconds / delay the showing of the new code
			setTimeout(function(){      //https://stackoverflow.com/questions/1836105/how-to-wait-5-seconds-with-jquery			
				
				// dynamically re-create the div element
				var $newdiv1 = $( "<div id='qrcode' ></div>" );
				$( "body" ).append( $newdiv1 );
				
				
				// generate a code
				qrcode = new QRCode(document.getElementById("qrcode"), link);


				// a dummy link for easier testing
				var $newlink = $( "<a href=" + link + " id='link'>link</a>" );
				$( "body" ).append( $newlink );
				

				// set/adjust/put in the middle of the screen/view area  assuming a 256px image size
				//  center horizontally
				document.getElementById("qrcode").style.margin="0 auto";
				document.getElementById("qrcode").style.width="256px";
				//  how about vertically ?
				// https://www.w3schools.com/css/css_dimension.asp
				// https://medium.freecodecamp.org/how-to-center-things-with-style-in-css-dc87b7542689   among others

				console.log("making code with '" + link + "'");
				
			},100);  // 2 seconds time before showing the new QR
			
			$("#qrcode").detach();		// clear/hide/remove the current code - its div tag

			$("#link").detach();
		});
		
		
	});
	</script>
	
	
	
	
</body>
</html>





